<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />

  <title>JWT Bearer Grant Type | OAuth2 Server PHP</title>

  <link rel="alternate" type="application/atom+xml" title="API Changes" href="changes.atom" />
  <link href="/oauth2-server-php-docs/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/oauth2-server-php-docs/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/oauth2-server-php-docs/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/oauth2-server-php-docs/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/oauth2-server-php-docs/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/oauth2-server-php-docs/css/coderay.css" rel="stylesheet" type="text/css" />

  <script src="/oauth2-server-php-docs/shared/js/jquery.js" type="text/javascript"></script>
  <script src="/oauth2-server-php-docs/shared/js/documentation.js" type="text/javascript"></script>
</head>
<body class="api">
    <div id="header-wrapper">
      <div id="header">
        <div>
          <a class="logo" href="/oauth2-server-php-docs/">
            <img src="/oauth2-server-php-docs/images/oauth2-banner.png"/>
          </a>
          <ul class="nav">
            <li><a href="https://github.com/bshaffer/oauth2-server-php/blob/develop/CHANGELOG.md">Changes</a></li>
            <!-- <li><a href="/oauth2-server-php-docs/changes.atom">
              <img src="/oauth2-server-php-docs/images/feed-icon-28x28.png" width="16" height="16" alt="GitHub API Changes Feed" />
            </a></li> -->
          </ul>
        </div>
      </div><!-- #header -->
    </div><!-- #header-wrapper -->

    <div id="wrapper">
      <div class="content">
    <h1>JWT Bearer</h1>

<h2>Overview</h2>

<p>The <code>JWT Bearer</code> grant type is used when the client wants to
receive access tokens without transmitting sensitive information
such as the client secret. This can also be used with trusted
clients to gain access to user resources without user authorization.</p>

<p><a href="http://tools.ietf.org/html/draft-ietf-oauth-jwt-bearer-07#section-1">Read more about jwt bearer</a></p>

<h2>Use Cases</h2>

<ul>
<li>same benefits as the Client Credentials grant type</li>
<li>allows for secure calls to be made without transmitting credentials</li>
<li>for trusted clients, allows access of user resources without authorization</li>
</ul>

<h2>Implementation</h2>

<p>Create an instance of <code>OAuth2\GrantType\JwtBearer</code> and add it to
your server:</p>

<div class="code-container">
<div class="langspec">Php</div>
<div class="CodeRay"><div class="code"><pre class="highlight"><code class="language-php"><span class="comment">// load public key from keystore</span>
<span class="local-variable">$public_key</span> = <span class="predefined">file_get_contents</span>(<span class="string"><span class="delimiter">'</span><span class="content">id_rsa.pub</span><span class="delimiter">'</span></span>);

<span class="comment">// assign the public key to a client and user</span>
<span class="local-variable">$clientKeys</span> = <span class="predefined">array</span>(<span class="string"><span class="delimiter">'</span><span class="content">TestClient</span><span class="delimiter">'</span></span> =&gt; <span class="predefined">array</span>(<span class="string"><span class="delimiter">'</span><span class="content">subject</span><span class="delimiter">'</span></span> =&gt; <span class="string"><span class="delimiter">'</span><span class="content">User1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">key</span><span class="delimiter">'</span></span> =&gt; <span class="local-variable">$public_key</span>));

<span class="comment">// create a storage object</span>
<span class="local-variable">$storage</span> = <span class="keyword">new</span> <span class="constant">OAuth2</span>\<span class="constant">Storage</span>\<span class="constant">Memory</span>(<span class="predefined">array</span>(<span class="string"><span class="delimiter">'</span><span class="content">jwt</span><span class="delimiter">'</span></span> =&gt; <span class="local-variable">$clientKeys</span>));

<span class="comment">// specify your audience (typically, the URI of the oauth server)</span>
<span class="local-variable">$audience</span> = <span class="string"><span class="delimiter">'</span><span class="content">https://api.mysite.com</span><span class="delimiter">'</span></span>;

<span class="comment">// create the grant type</span>
<span class="local-variable">$grantType</span> = <span class="keyword">new</span> <span class="constant">OAuth2</span>\<span class="constant">GrantType</span>\<span class="constant">JwtBearer</span>(<span class="local-variable">$storage</span>, <span class="local-variable">$audience</span>);

<span class="comment">// add the grant type to your OAuth server</span>
<span class="local-variable">$server</span>-&gt;addGrantType(<span class="local-variable">$grantType</span>);</code></pre></div></div>
</div>

<h2>Example Request</h2>

<p>JWT requests require the signing of the JWT assertion using
<a href="http://en.wikipedia.org/wiki/Public-key_cryptography">public key cryptography</a>.
The code snippet below provides an example of how this might be done.</p>

<div class="code-container">
<div class="langspec">Php</div>
<div class="CodeRay"><div class="code"><pre class="highlight"><code class="language-php"><span class="comment">/**
 * Generate a JWT
 *
 * @param $privateKey The private key to use to sign the token
 * @param $iss The issuer, usually the client_id
 * @param $sub The subject, usually a user_id
 * @param $aud The audience, usually the URI for the oauth server
 * @param $exp The expiration date. If the current time is greater than the exp, the JWT is invalid
 * @param $nbf The "not before" time. If the current time is less than the nbf, the JWT is invalid
 * @param $jti The "jwt token identifier", or nonce for this JWT
 *
 * @return string
 */</span>
<span class="keyword">function</span> <span class="function">generateJWT</span>(<span class="local-variable">$privateKey</span>, <span class="local-variable">$iss</span>, <span class="local-variable">$sub</span>, <span class="local-variable">$aud</span>, <span class="local-variable">$exp</span> = <span class="predefined-constant">null</span>, <span class="local-variable">$nbf</span> = <span class="predefined-constant">null</span>, <span class="local-variable">$jti</span> = <span class="predefined-constant">null</span>)
{
    <span class="keyword">if</span> (!<span class="local-variable">$exp</span>) {
        <span class="local-variable">$exp</span> = <span class="predefined">time</span>() + <span class="integer">1000</span>;
    }

    <span class="local-variable">$params</span> = <span class="predefined">array</span>(
        <span class="string"><span class="delimiter">'</span><span class="content">iss</span><span class="delimiter">'</span></span> =&gt; <span class="local-variable">$iss</span>,
        <span class="string"><span class="delimiter">'</span><span class="content">sub</span><span class="delimiter">'</span></span> =&gt; <span class="local-variable">$sub</span>,
        <span class="string"><span class="delimiter">'</span><span class="content">aud</span><span class="delimiter">'</span></span> =&gt; <span class="local-variable">$aud</span>,
        <span class="string"><span class="delimiter">'</span><span class="content">exp</span><span class="delimiter">'</span></span> =&gt; <span class="local-variable">$exp</span>,
        <span class="string"><span class="delimiter">'</span><span class="content">iat</span><span class="delimiter">'</span></span> =&gt; <span class="predefined">time</span>(),
    );

    <span class="keyword">if</span> (<span class="local-variable">$nbf</span>) {
        <span class="local-variable">$params</span>[<span class="string"><span class="delimiter">'</span><span class="content">nbf</span><span class="delimiter">'</span></span>] = <span class="local-variable">$nbf</span>;
    }

    <span class="keyword">if</span> (<span class="local-variable">$jti</span>) {
        <span class="local-variable">$params</span>[<span class="string"><span class="delimiter">'</span><span class="content">jti</span><span class="delimiter">'</span></span>] = <span class="local-variable">$jti</span>;
    }

    <span class="local-variable">$jwtUtil</span> = <span class="keyword">new</span> <span class="constant">OAuth2</span>\<span class="constant">Encryption</span>\<span class="constant">Jwt</span>();

    <span class="keyword">return</span> <span class="local-variable">$jwtUtil</span>-&gt;encode(<span class="local-variable">$params</span>, <span class="local-variable">$privateKey</span>, <span class="string"><span class="delimiter">'</span><span class="content">RS256</span><span class="delimiter">'</span></span>);
}</code></pre></div></div>
</div>

<blockquote><p>Note: This example uses the <code>OAuth2\Encryption\Jwt</code> class provided in this library. This is
not necessary for JWT authentication, but it is convenient.</p></blockquote>

<p>This function can then be called to generate the payload for the request. Write a script to
generate the jwt and request a token:</p>

<div class="code-container">
<div class="langspec">Php</div>
<div class="CodeRay"><div class="code"><pre class="highlight"><code class="language-php"><span class="local-variable">$private_key</span> = <span class="predefined">file_get_contents</span>(<span class="string"><span class="delimiter">'</span><span class="content">id_rsa</span><span class="delimiter">'</span></span>);
<span class="local-variable">$client_id</span>   = <span class="string"><span class="delimiter">'</span><span class="content">TestClient</span><span class="delimiter">'</span></span>;
<span class="local-variable">$user_id</span>     = <span class="string"><span class="delimiter">'</span><span class="content">User1</span><span class="delimiter">'</span></span>;
<span class="local-variable">$grant_type</span>  = <span class="string"><span class="delimiter">'</span><span class="content">urn:ietf:params:oauth:grant-type:jwt-bearer</span><span class="delimiter">'</span></span>;

<span class="local-variable">$jwt</span> = generateJWT(<span class="local-variable">$private_key</span>, <span class="local-variable">$client_id</span>, <span class="local-variable">$user_id</span>, <span class="string"><span class="delimiter">'</span><span class="content">https://api.mysite.com</span><span class="delimiter">'</span></span>);

<span class="predefined">passthru</span>(<span class="string"><span class="delimiter">"</span><span class="content">curl https://api.mysite.com/token -d 'grant_type=</span><span class="local-variable">$grant_type</span><span class="content">&amp;assertion=</span><span class="local-variable">$jwt</span><span class="content">'</span><span class="delimiter">"</span></span>);</code></pre></div></div>
</div>

<p>A successful token request will return a standard access token in JSON format:</p>

<div class="code-container">
<div class="langspec">Json</div>
<div class="CodeRay"><div class="code"><pre class="highlight"><code class="language-json">{<span class="key"><span class="delimiter">"</span><span class="content">access_token</span><span class="delimiter">"</span></span>:<span class="string"><span class="delimiter">"</span><span class="content">03807cb390319329bdf6c777d4dfae9c0d3b3c35</span><span class="delimiter">"</span></span>,<span class="key"><span class="delimiter">"</span><span class="content">expires_in</span><span class="delimiter">"</span></span>:<span class="integer">3600</span>,<span class="key"><span class="delimiter">"</span><span class="content">token_type</span><span class="delimiter">"</span></span>:<span class="string"><span class="delimiter">"</span><span class="content">bearer</span><span class="delimiter">"</span></span>,<span class="key"><span class="delimiter">"</span><span class="content">scope</span><span class="delimiter">"</span></span>:<span class="value">null</span>}</code></pre></div></div>
</div>


      </div>

    <div id="js-sidebar" class="sidebar-shell">
      <div class="js-toggle-list sidebar-module expandable">
        <ul>
          <li class="js-topic">
            <h3><a href="#" class="js-expand-btn collapsed">&nbsp;</a><a href="/oauth2-server-php-docs/">Overview</a></h3>
            <ul class="js-guides">
              <li><a href="/oauth2-server-php-docs/">Get Started</a></li>
              <li><a href="/oauth2-server-php-docs/overview/main-concepts/">Main Concepts</a></li>
              <li><a href="/oauth2-server-php-docs/overview/grant-types/">Grant Types</a></li>
              <li><a href="/oauth2-server-php-docs/overview/controllers/">Controllers</a></li>
              <li><a href="/oauth2-server-php-docs/overview/storage/">Storage</a></li>
              <li><a href="/oauth2-server-php-docs/overview/response/">Request and Response</a></li>
              <li><a href="/oauth2-server-php-docs/overview/scope/">Scope</a></li>
              <li><a href="/oauth2-server-php-docs/overview/userid/">User ID</a></li>
              <li><a href="/oauth2-server-php-docs/overview/crypto-tokens/">Crypto Tokens</a></li>
            </ul>
          </li>
          <li class="js-topic">
            <h3><a href="#" class="js-expand-btn collapsed">&nbsp;</a><a href="/oauth2-server-php-docs/grant-types/authorization-code/">Grant Types</a></h3>
            <ul class="js-guides">
              <li><a href="/oauth2-server-php-docs/grant-types/authorization-code/">Authorization Code</a></li>
              <li><a href="/oauth2-server-php-docs/grant-types/implicit/">Implicit</a></li>
              <li><a href="/oauth2-server-php-docs/grant-types/user-credentials/">User Credentials</a></li>
              <li><a href="/oauth2-server-php-docs/grant-types/client-credentials/">Client Credentials</a></li>
              <li><a href="/oauth2-server-php-docs/grant-types/refresh-token/">Refresh Token</a></li>
              <li><a href="/oauth2-server-php-docs/grant-types/jwt-bearer/">JWT Bearer</a></li>
            </ul>
          </li>
          <li class="js-topic">
            <h3><a href="#" class="js-expand-btn collapsed">&nbsp;</a><a href="/oauth2-server-php-docs/controllers/authorize">Controllers</a></h3>
            <ul class="js-guides">
              <li><a href="/oauth2-server-php-docs/controllers/authorize">Authorize</a></li>
              <li><a href="/oauth2-server-php-docs/controllers/resource/">Resource</a></li>
              <li><a href="/oauth2-server-php-docs/controllers/token/">Token</a></li>
            </ul>
          </li>
          <li class="js-topic">
            <h3><a href="#" class="js-expand-btn collapsed">&nbsp;</a><a href="/oauth2-server-php-docs/storage/pdo/">Storage</a></h3>
            <ul class="js-guides">
              <li><a href="/oauth2-server-php-docs/storage/pdo/">PDO</a></li>
              <li><a href="/oauth2-server-php-docs/storage/mongo/">Mongo</a></li>
              <li><a href="/oauth2-server-php-docs/storage/redis/">Redis</a></li>
              <li><a href="/oauth2-server-php-docs/storage/cassandra/">Cassandra</a></li>
              <li><a href="/oauth2-server-php-docs/storage/custom/">Custom Storage</a></li>
              <li><a href="/oauth2-server-php-docs/storage/multiple/">Using Multiple Storages</a></li>
            </ul>
          </li>
          <li class="js-topic">
            <h3><a href="#" class="js-expand-btn collapsed">&nbsp;</a><a href="/oauth2-server-php-docs/cookbook/">Cookbook</a></h3>
            <ul class="js-guides">
              <li><a href="/oauth2-server-php-docs/cookbook/">Step-By-Step Walkthrough</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/google-playground/">Google Playground</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/drupal/">Drupal</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/symfony2/">Symfony2</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/silex/">Silex</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/zend-framework/">Zend Framework</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/laravel/">Laravel</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/doctrine/">Doctrine</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/cakephp/">CakePHP</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/restler/">Restler</a></li>
              <!-- <li><a href="/oauth2-server-php-docs/cookbook/doctrine2/">Doctrine2</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/symfony/">Symfony 1.4</a></li> -->
            </ul>
          </li>
        </ul>
      </div> <!-- /sidebar-module -->
      <div class="sidebar-module">
        <p>This project is open source. Please help us by forking the project and adding to it.</p>
      </div>
    </div><!-- /sidebar-shell -->

    </div><!-- #wrapper -->

    <div id="footer" >
      <div class="upper_footer">
        <div class="footer_inner clearfix">

        </div><!-- /.site -->
      </div><!-- /.upper_footer -->

      <div class="lower_footer">
        <div class="footer_inner clearfix">
            <div id="legal">
              <p>&copy; <span id="year">year</span> Brent Shaffer. All rights reserved.</p>
            </div><!-- /#legal or /#legal_ie-->
        </div><!-- /.site -->
      </div><!-- /.lower_footer -->
    </div><!-- /#footer -->
    <a href="https://github.com/bshaffer/oauth2-server-php-docs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-11590669-6', 'bshaffer.github.io');
      ga('send', 'pageview');

      function trackOutboundLink(link, category, action) {
        try {
          _gaq.push(['_trackEvent', category , action]);
        } catch(err){}

        setTimeout(function() {
          document.location.href = link.href;
        }, 100);
      }
    </script>
</body>
</html>
